local InputService = game:GetService('UserInputService');
local TextService = game:GetService('TextService');
local CoreGui = game:GetService('CoreGui');
local Teams = game:GetService('Teams');
local Players = game:GetService('Players');
local RunService = game:GetService('RunService');
local TweenService = game:GetService('TweenService');
local RenderStepped = RunService.RenderStepped;
local LocalPlayer = Players.LocalPlayer;
local Mouse = LocalPlayer:GetMouse();
local ProtectGui = protectgui or (syn and syn.protect_gui) or (function() end);
local ScreenGui = Instance.new('ScreenGui');
ProtectGui(ScreenGui);
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Global;
ScreenGui.Parent = CoreGui;
local Toggles = {};
local Options = {};
getgenv().Toggles = Toggles;
getgenv().Options = Options;
local Library = {
    Registry = {};
    RegistryMap = {};
    HudRegistry = {};
    FontColor = Color3.fromRGB(255, 255, 255);
    MainColor = Color3.fromRGB(28, 28, 28);
    BackgroundColor = Color3.fromRGB(20, 20, 20);
    AccentColor = Color3.fromRGB(0, 85, 255);
    OutlineColor = Color3.fromRGB(50, 50, 50);
    RiskColor = Color3.fromRGB(255, 50, 50);
    Black = Color3.new(0, 0, 0);
    Font = Enum.Font.Code;
    OpenedFrames = {};
    DependencyBoxes = {};
    Signals = {};
    ScreenGui = ScreenGui;
    IsMobile = InputService.TouchEnabled;
    UILocked = false;
};
local RainbowStep = 0;
local Hue = 0;
table.insert(Library.Signals, RenderStepped:Connect(function(Delta)
    RainbowStep = RainbowStep + Delta;
    if RainbowStep >= (1 / 60) then
        RainbowStep = 0;
        Hue = Hue + (1 / 400);
        if Hue > 1 then
            Hue = 0;
        end;
        Library.CurrentRainbowHue = Hue;
        Library.CurrentRainbowColor = Color3.fromHSV(Hue, 0.8, 1);
    end;
end));
local function GetPlayersString()
    local PlayerList = Players:GetPlayers();
    for i = 1, #PlayerList do
        PlayerList[i] = PlayerList[i].Name;
    end;
    table.sort(PlayerList, function(str1, str2) return str1 < str2 end);
    return PlayerList;
end;
local function GetTeamsString()
    local TeamList = Teams:GetTeams();
    for i = 1, #TeamList do
        TeamList[i] = TeamList[i].Name;
    end;
    table.sort(TeamList, function(str1, str2) return str1 < str2 end);
    return TeamList;
end;
function Library:SafeCallback(f, ...)
    if (not f) then
        return;
    end;
    if not Library.NotifyOnError then
        return f(...);
    end;
    local success, event = pcall(f, ...);
    if not success then
        local _, i = event:find(":%d+: ");
        if not i then
            return Library:Notify(event);
        end;
        return Library:Notify(event:sub(i + 1), 3);
    end;
end;
function Library:AttemptSave()
    if Library.SaveManager then
        Library.SaveManager:Save();
    end;
end;
function Library:Create(Class, Properties)
    local _Instance = Class;
    if type(Class) == 'string' then
        _Instance = Instance.new(Class);
    end;
    for Property, Value in next, Properties do
        _Instance[Property] = Value;
    end;
    return _Instance;
end;
function Library:ApplyTextStroke(Inst)
    Inst.TextStrokeTransparency = 1;
    Library:Create('UIStroke', {
        Color = Color3.new(0, 0, 0);
        Thickness = 1;
        LineJoinMode = Enum.LineJoinMode.Miter;
        Parent = Inst;
    });
end;
function Library:CreateLabel(Properties, IsHud)
    local _Instance = Library:Create('TextLabel', {
        BackgroundTransparency = 1;
        Font = Library.Font;
        TextColor3 = Library.FontColor;
        TextSize = 16;
        TextStrokeTransparency = 0;
    });
    Library:ApplyTextStroke(_Instance);
    Library:AddToRegistry(_Instance, {
        TextColor3 = 'FontColor';
    }, IsHud);
    return Library:Create(_Instance, Properties);
end;
function Library:MakeDraggable(Instance, Cutoff)
    Instance.Active = true;
    local Dragging = false;
    local DragStart, StartPos;
    
    -- Mouse-based dragging (existing)
    Instance.InputBegan:Connect(function(Input)
        if Input.UserInputType == Enum.UserInputType.MouseButton1 and not Library.UILocked then
            local ObjPos = Vector2.new(
                Mouse.X - Instance.AbsolutePosition.X,
                Mouse.Y - Instance.AbsolutePosition.Y
            );
            if ObjPos.Y > (Cutoff or 40) then
                return;
            end;
            Dragging = true;
            DragStart = Vector2.new(Mouse.X, Mouse.Y);
            StartPos = Instance.Position;
            while Dragging and InputService:IsMouseButtonPressed(Enum.UserInputType.MouseButton1) do
                local Delta = Vector2.new(Mouse.X - DragStart.X, Mouse.Y - DragStart.Y);
                Instance.Position = UDim2.new(
                    StartPos.X.Scale,
                    StartPos.X.Offset + Delta.X,
                    StartPos.Y.Scale,
                    StartPos.Y.Offset + Delta.Y
                );
                RenderStepped:Wait();
            end;
            Dragging = false;
        end;
    end);
    Instance.InputEnded:Connect(function(Input)
        if Input.UserInputType == Enum.UserInputType.MouseButton1 then
            Dragging = false;
        end;
    end);
    
    -- Touch-based dragging for mobile
    if Library.IsMobile then
        Instance.InputBegan:Connect(function(Input)
            if Input.UserInputType == Enum.UserInputType.Touch and not Library.UILocked then
                local Touch = Input.Position;
                local ObjPos = Vector2.new(
                    Touch.X - Instance.AbsolutePosition.X,
                    Touch.Y - Instance.AbsolutePosition.Y
                );
                if ObjPos.Y > (Cutoff or 40) then
                    return;
                end;
                Dragging = true;
                DragStart = Vector2.new(Touch.X, Touch.Y);
                StartPos = Instance.Position;
            end;
        end);
        Instance.InputChanged:Connect(function(Input)
            if Input.UserInputType == Enum.UserInputType.Touch and Dragging and not Library.UILocked then
                local Touch = Input.Position;
                local Delta = Vector2.new(Touch.X - DragStart.X, Touch.Y - DragStart.Y);
                Instance.Position = UDim2.new(
                    StartPos.X.Scale,
                    StartPos.X.Offset + Delta.X,
                    StartPos.Y.Scale,
                    StartPos.Y.Offset + Delta.Y
                );
            end;
        end);
        Instance.InputEnded:Connect(function(Input)
            if Input.UserInputType == Enum.UserInputType.Touch then
                Dragging = false;
            end;
        end);
    end;
end;
function Library:AddToolTip(InfoStr, HoverInstance)
    local X, Y = Library:GetTextBounds(InfoStr, Library.Font, 14);
    local Tooltip = Library:Create('Frame', {
        BackgroundColor3 = Library.MainColor,
        BorderColor3 = Library.OutlineColor,
        Size = UDim2.fromOffset(X + 5, Y + 4),
        ZIndex = 100,
        Parent = Library.ScreenGui,
        Visible = false,
    });
    local Label = Library:CreateLabel({
        Position = UDim2.fromOffset(3, 1),
        Size = UDim2.fromOffset(X, Y);
        TextSize = 14;
        Text = InfoStr,
        TextColor3 = Library.FontColor,
        TextXAlignment = Enum.TextXAlignment.Left;
        ZIndex = Tooltip.ZIndex + 1,
        Parent = Tooltip;
    });
    Library:AddToRegistry(Tooltip, {
        BackgroundColor3 = 'MainColor';
        BorderColor3 = 'OutlineColor';
    });
    Library:AddToRegistry(Label, {
        TextColor3 = 'FontColor',
    });
    local IsHovering = false;
    local function UpdateTooltipPosition(PosX, PosY)
        Tooltip.Position = UDim2.fromOffset(PosX + 15, PosY + 12);
    end;
    HoverInstance.MouseEnter:Connect(function()
        if Library:MouseIsOverOpenedFrame() then
            return;
        end;
        IsHovering = true;
        UpdateTooltipPosition(Mouse.X, Mouse.Y);
        Tooltip.Visible = true;
        while IsHovering do
            UpdateTooltipPosition(Mouse.X, Mouse.Y);
            RunService.Heartbeat:Wait();
        end;
    end);
    HoverInstance.MouseLeave:Connect(function()
        IsHovering = false;
        Tooltip.Visible = false;
    end);
    if Library.IsMobile then
        HoverInstance.InputBegan:Connect(function(Input)
            if Input.UserInputType == Enum.UserInputType.Touch and not Library:MouseIsOverOpenedFrame() then
                IsHovering = true;
                UpdateTooltipPosition(Input.Position.X, Input.Position.Y);
                Tooltip.Visible = true;
            end;
        end);
        HoverInstance.InputEnded:Connect(function(Input)
            if Input.UserInputType == Enum.UserInputType.Touch then
                IsHovering = false;
                Tooltip.Visible = false;
            end;
        end);
    end;
end;
function Library:OnHighlight(HighlightInstance, Instance, Properties, PropertiesDefault)
    HighlightInstance.MouseEnter:Connect(function()
        local Reg = Library.RegistryMap[Instance];
        for Property, ColorIdx in next, Properties do
            Instance[Property] = Library[ColorIdx] or ColorIdx;
            if Reg and Reg.Properties[Property] then
                Reg.Properties[Property] = ColorIdx;
            end;
        end;
    end);
    HighlightInstance.MouseLeave:Connect(function()
        local Reg = Library.RegistryMap[Instance];
        for Propertyà·ƒ

System8: Property, ColorIdx in next, PropertiesDefault do
            Instance[Property] = Library[ColorIdx] or ColorIdx;
            if Reg and Reg.Properties[Property] then
                Reg.Properties[Property] = ColorIdx;
            end;
        end;
    end);
    if Library.IsMobile then
        HighlightInstance.InputBegan:Connect(function(Input)
            if Input.UserInputType == Enum.UserInputType.Touch then
                local Reg = Library.RegistryMap[Instance];
                for Property, ColorIdx in next, Properties do
                    Instance[Property] = Library[ColorIdx] or ColorIdx;
                    if Reg and Reg.Properties[Property] then
                        Reg.Properties[Property] = ColorIdx;
                    end;
                end;
            end;
        end);
        HighlightInstance.InputEnded:Connect(function(Input)
            if Input.UserInputType == Enum.UserInputType.Touch then
                local Reg = Library.RegistryMap[Instance];
                for Property, ColorIdx in next, PropertiesDefault do
                    Instance[Property] = Library[ColorIdx] or ColorIdx;
                    if Reg and Reg.Properties[Property] then
                        Reg.Properties[Property] = ColorIdx;
                    end;
                end;
            end;
        end);
    end;
end;
function Library:MouseIsOverOpenedFrame()
    for Frame, _ in next, Library.OpenedFrames do
        local AbsPos, AbsSize = Frame.AbsolutePosition, Frame.AbsoluteSize;
        if Library.IsMobile then
            for _, Input in pairs(InputService:GetTouches()) do
                local TouchPos = Input.Position;
                if TouchPos.X >= AbsPos.X and TouchPos.X <= AbsPos.X + AbsSize.X
                    and TouchPos.Y >= AbsPos.Y and TouchPos.Y <= AbsPos.Y + AbsSize.Y then
                    return true;
                end;
            end;
        else
            if Mouse.X >= AbsPos.X and Mouse.X <= AbsPos.X + AbsSize.X
                and Mouse.Y >= AbsPos.Y and Mouse.Y <= AbsPos.Y + AbsSize.Y then
                return true;
            end;
        end;
    end;
    return false;
end;
function Library:IsMouseOverFrame(Frame)
    local AbsPos, AbsSize = Frame.AbsolutePosition, Frame.AbsoluteSize;
    if Library.IsMobile then
        for _, Input in pairs(InputService:GetTouches()) do
            local TouchPos = Input.Position;
            if TouchPos.X >= AbsPos.X and TouchPos.X <= AbsPos.X + AbsSize.X
                and TouchPos.Y >= AbsPos.Y and TouchPos.Y <= AbsPos.Y + AbsSize.Y then
                return true;
            end;
        end;
    else
        if Mouse.X >= AbsPos.X and Mouse.X <= AbsPos.X + AbsSize.X
            and Mouse.Y >= AbsPos.Y and Mouse.Y <= AbsPos.Y + AbsSize.Y then
            return true;
        end;
    end;
    return false;
end;
function Library:UpdateDependencyBoxes()
    for _, Depbox in next, Library.DependencyBoxes do
        Depbox:Update();
    end;
end;
function Library:MapValue(Value, MinA, MaxA, MinB, MaxB)
    return (1 - ((Value - MinA) / (MaxA - MinA))) * MinB + ((Value - MinA) / (MaxA - MinA)) * MaxB;
end;
function Library:GetTextBounds(Text, Font, Size, Resolution)
    local Bounds = TextService:GetTextSize(Text, Size, Font, Resolution or Vector2.new(1920, 1080));
    return Bounds.X, Bounds.Y;
end;
function Library:GetDarkerColor(Color)
    local H, S, V = Color3.toHSV(Color);
    return Color3.fromHSV(H, S, V / 1.5);
end;
Library.AccentColorDark = Library:GetDarkerColor(Library.AccentColor);
function Library:AddToRegistry(Instance, Properties, IsHud)
    local Idx = #Library.Registry + 1;
    local Data = {
        Instance = Instance;
        Properties = Properties;
        Idx = Idx;
    };
    table.insert(Library.Registry, Data);
    Library.RegistryMap[Instance] = Data;
    if IsHud then
        table.insert(Library.HudRegistry, Data);
    end;
end;
function Library:RemoveFromRegistry(Instance)
    local Data = Library.RegistryMap[Instance];
    if Data then
        for Idx = #Library.Registry, 1, -1 do
            if Library.Registry[Idx] == Data then
                table.remove(Library.Registry, Idx);
            end;
        end;
        for Idx = #Library.HudRegistry, 1, -1 do
            if Library.HudRegistry[Idx] == Data then
                table.remove(Library.HudRegistry, Idx);
            end;
        end;
        Library.RegistryMap[Instance] = nil;
    end;
end;
function Library:UpdateColorsUsingRegistry()
    for Idx, Object in next, Library.Registry do
        for Property, ColorIdx in next, Object.Properties do
            if type(ColorIdx) == 'string' then
                Object.Instance[Property] = Library[ColorIdx];
            elseif type(ColorIdx) == 'function' then
                Object.Instance[Property] = ColorIdx();
            end;
        end;
    end;
end;
function Library:GiveSignal(Signal)
    table.insert(Library.Signals, Signal);
end;
function Library:Unload()
    for Idx = #Library.Signals, 1, -1 do
        local Connection = table.remove(Library.Signals, Idx);
        Connection:Disconnect();
    end;
    if Library.OnUnload then
        Library.OnUnload();
    end;
    ScreenGui:Destroy();
end;
function Library:OnUnload(Callback)
    Library.OnUnload = Callback;
end;
Library:GiveSignal(ScreenGui.DescendantRemoving:Connect(function(Instance)
    if Library.RegistryMap[Instance] then
        Library:RemoveFromRegistry(Instance);
    end;
end));
local BaseAddons = {};
do
    local Funcs = {};
    function Funcs:AddColorPicker(Idx, Info)
        local ToggleLabel = self.TextLabel;
        assert(Info.Default, 'AddColorPicker: Missing default value.');
        local ColorPicker = {
            Value = Info.Default;
            Transparency = Info.Transparency or 0;
            Type = 'ColorPicker';
            Title = type(Info.Title) == 'string' and Info.Title or 'Color picker',
            Callback = Info.Callback or function(Color) end;
        };
        function ColorPicker:SetHSVFromRGB(Color)
            local H, S, V = Color3.toHSV(Color);
            ColorPicker.Hue = H;
            ColorPicker.Sat = S;
            ColorPicker.Vib = V;
        end;
        ColorPicker:SetHSVFromRGB(ColorPicker.Value);
        local DisplayFrame = Library:Create('Frame', {
            BackgroundColor3 = ColorPicker.Value;
            BorderColor3 = Library:GetDarkerColor(ColorPicker.Value);
            BorderMode = Enum.BorderMode.Inset;
            Size = UDim2.new(0, 28, 0, 14);
            ZIndex = 6;
            Parent = ToggleLabel;
        });
        local CheckerFrame = Library:Create('ImageLabel', {
            BorderSizePixel = 0;
            Size = UDim2.new(0, 27, 0, 13);
            ZIndex = 5;
            Image = 'http://www.roblox.com/asset/?id=12977615774';
            Visible = not not Info.Transparency;
            Parent = DisplayFrame;
        });
        local PickerFrameOuter = Library:Create('Frame', {
            Name = 'Color';
            BackgroundColor3 = Color3.new(1, 1, 1);
            BorderColor3 = Color3.new(0, 0, 0);
            Position = UDim2.fromOffset(DisplayFrame.AbsolutePosition.X, DisplayFrame.AbsolutePosition.Y + 18),
            Size = UDim2.fromOffset(230, Info.Transparency and 271 or 253);
            Visible = false;
            ZIndex = 15;
            Parent = ScreenGui,
        });
        DisplayFrame:GetPropertyChangedSignal('AbsolutePosition'):Connect(function()
            PickerFrameOuter.Position = UDim2.fromOffset(DisplayFrame.AbsolutePosition.X, DisplayFrame.AbsolutePosition.Y + 18);
        end);
        local PickerFrameInner = Library:Create('Frame', {
            BackgroundColor3 = Library.BackgroundColor;
            BorderColor3 = Library.OutlineColor;
            BorderMode = Enum.BorderMode.Inset;
            Size = UDim2.new(1, 0, 1, 0);
            ZIndex = 16;
            Parent = PickerFrameOuter;
        });
        local Highlight = Library:Create('Frame', {
            BackgroundColor3 = Library.AccentColor;
            BorderSizePixel = 0;
            Size = UDim2.new(1, 0, 0, 2);
            ZIndex = 17;
            Parent = PickerFrameInner;
        });
        local SatVibMapOuter = Library:Create('Frame', {
            BorderColor3 = Color3.new(0, 0, 0);
            Position = UDim2.new(0, 4, 0, 25);
            Size = UDim2.new(0, 200, 0, 200);
            ZIndex = 17;
            Parent = PickerFrameInner;
        });
        local SatVibMapInner = Library:Create('Frame', {
            BackgroundColor3 = Library.BackgroundColor;
            BorderColor3 = Library.OutlineColor;
            BorderMode = Enum.BorderMode.Inset;
            Size = UDim2.new(1, 0, 1, 0);
            ZIndex = 18;
            Parent = SatVibMapOuter;
        });
        local SatVibMap = Library:Create('ImageLabel', {
            BorderSizePixel = 0;
            Size = UDim2.new(1, 0, 1, 0);
            ZIndex = 18;
            Image = 'rbxassetid://4155801252';
            Parent = SatVibMapInner;
        });
        local CursorOuter = Library:Create('ImageLabel', {
            AnchorPoint = Vector2.new(0.5, 0.5);
            Size = UDim2.new(0, 6, 0, 6);
            BackgroundTransparency = 1;
            Image = 'http://www.roblox.com/asset/?id=9619665977';
            ImageColor3 = Color3.new(0, 0, 0);
            ZIndex = 19;
            Parent = SatVibMap;
        });
        local CursorInner = Library:Create('ImageLabel', {
            Size = UDim2.new(0, CursorOuter.Size.X.Offset - 2, 0, CursorOuter.Size.Y.Offset - 2);
            Position = UDim2.new(0, 1, 0, 1);
            BackgroundTransparency = 1;
            Image = 'http://www.roblox.com/asset/?id=9619665977';
            ZIndex = 20;
            Parent = CursorOuter;
        });
        local HueSelectorOuter = Library:Create('Frame', {
            BorderColor3 = Color3.new(0, 0, 0);
            Position = UDim2.new(0, 208, 0, 25);
            Size = UDim2.new(0, 15, 0, 200);
            ZIndex = 17;
            Parent = PickerFrameInner;
        });
        local HueSelectorInner = Library:Create('Frame', {
            BackgroundColor3 = Color3.new(1, 1, 1);
            BorderSizePixel = 0;
            Size = UDim2.new(1, 0, 1, 0);
            ZIndex = 18;
            Parent = HueSelectorOuter;
        });
        local HueCursor = Library:Create('Frame', {
            BackgroundColor3 = Color3.new(1, 1, 1);
            AnchorPoint = Vector2.new(0, 0.5);
            BorderColor3 = Color3.new(0, 0, 0);
            Size = UDim2.new(1, 0, 0, 1);
            ZIndex = 18;
            Parent = HueSelectorInner;
        });
        local HueBoxOuter = Library:Create('Frame', {
            BorderColor3 = Color3.new(0, 0, 0);
            Position = UDim2.fromOffset(4, 228),
            Size = UDim2.new(0.5, -6, 0, 20),
            ZIndex = 18,
            Parent = PickerFrameInner;
        });
        local HueBoxInner = Library:Create('Frame', {
            BackgroundColor3 = Library.MainColor;
            BorderColor3 = Library.OutlineColor;
            BorderMode = Enum.BorderMode.Inset;
            Size = UDim2.new(1, 0, 1, 0);
            ZIndex = 18,
            Parent = HueBoxOuter;
        });
        Library:Create('UIGradient', {
            Color = ColorSequence.new({
                ColorSequenceKeypoint.new(0, Color3.new(1, 1, 1)),
                ColorSequenceKeypoint.new(1, Color3.fromRGB(212, 212, 212))
            });
            Rotation = 90;
            Parent = HueBoxInner;
        });
        local HueBox = Library:Create('TextBox', {
            BackgroundTransparency = 1;
            Position = UDim2.new(0, 5, 0, 0);
            Size = UDim2.new(1, -5, 1, 0);
            Font = Library.Font;
            PlaceholderColor3 = Color3.fromRGB(190, 190, 190);
            PlaceholderText = 'Hex color',
            Text = '#FFFFFF',
            TextColor3 = Library.FontColor;
            TextSize = 14;
            TextStrokeTransparency = 0;
            TextXAlignment = Enum.TextXAlignment.Left;
            ZIndex = 20,
            Parent = HueBoxInner;
        });
        Library:ApplyTextStroke(HueBox);
        local RgbBoxBase = Library:Create(HueBoxOuter:Clone(), {
            Position = UDim2.new(0.5, 2, 0, 228),
            Size = UDim2.new(0.5, -6, 0, 20),
            Parent = PickerFrameInner
        });
        local RgbBox = Library:Create(RgbBoxBase.Frame:FindFirstChild('TextBox'), {
            Text = '255, 255, 255',
            PlaceholderText = 'RGB color',
            TextColor3 = Library.FontColor
        });
        local TransparencyBoxOuter, TransparencyBoxInner, TransparencyCursor;
        if Info.Transparency then
            TransparencyBoxOuter = Library:Create('Frame', {
                BorderColor3 = Color3.new(0, 0, 0);
                Position = UDim2.fromOffset(4, 251);
                Size = UDim2.new(1, -8, 0, 15);
                ZIndex = 19;
                Parent = PickerFrameInner;
            });
            TransparencyBoxInner = Library:Create('Frame', {
                BackgroundColor3 = ColorPicker.Value;
                BorderColor3 = Library.OutlineColor;
                BorderMode = Enum.BorderMode.Inset;
                Size = UDim2.new(1, 0, 1, 0);
                ZIndex = 19;
                Parent = TransparencyBoxOuter;
            });
            Library:AddToRegistry(TransparencyBoxInner, { BorderColor3 = 'OutlineColor' });
            Library:Create('ImageLabel', {
                BackgroundTransparency = 1;
                Size = UDim2.new(1, 0, 1, 0);
                Image = 'http://www.roblox.com/asset/?id=12978095818';
                ZIndex = 20;
                Parent = TransparencyBoxInner;
            });
            TransparencyCursor = Library:Create('Frame', {
                BackgroundColor3 = Color3.new(1, 1, 1);
                AnchorPoint = Vector2.new(0.5, 0);
                BorderColor3 = Color3.new(0, 0, 0);
                Size = UDim2.new(0, 1, 1, 0);
                ZIndex = 21;
                Parent = TransparencyBoxInner;
            });
        end;
        local DisplayLabel = Library:CreateLabel({
            Size = UDim2.new(1, 0, 0, 14);
            Position = UDim2.fromOffset(5, 5);
            TextXAlignment = Enum.TextXAlignment.Left;
            TextSize = 14;
            Text = ColorPicker.Title;
            TextWrapped = false;
            ZIndex = 16;
            Parent = PickerFrameInner;
        });
        local ContextMenu = {};
        do
            ContextMenu.Options = {};
            ContextMenu.Container = Library:Create('Frame', {
                BorderColor3 = Color3.new();
                ZIndex = 14,
                Visible = false,
                Parent = ScreenGui
            });
            ContextMenu.Inner = Library:Create('Frame', {
                BackgroundColor3 = Library.BackgroundColor;
                BorderColor3 = Library.OutlineColor;
                BorderMode = Enum.BorderMode.Inset;
                Size = UDim2.fromScale(1, 1);
                ZIndex = 15;
                Parent = ContextMenu.Container;
            });
            Library:Create('UIListLayout', {
                Name = 'Layout',
                FillDirection = Enum.FillDirection.Vertical;
                SortOrder = Enum.SortOrder.LayoutOrder;
                Parent = ContextMenu.Inner;
            });
            Library:Create('UIPadding', {
                Name = 'Padding',
                PaddingLeft = UDim.new(0, 4),
                Parent = ContextMenu.Inner,
            });
            local function updateMenuPosition()
                ContextMenu.Container.Position = UDim2.fromOffset(
                    (DisplayFrame.AbsolutePosition.X + DisplayFrame.AbsoluteSize.X) + 4,
                    DisplayFrame.AbsolutePosition.Y + 1
                );
            end;
            local function updateMenuSize()
                local menuWidth = 60;
                for i, label in next, ContextMenu.Inner:GetChildren() do
                    if label:IsA('TextLabel') then
                        menuWidth = math.max(menuWidth, label.TextBounds.X);
                    end;
                end;
                ContextMenu.Container.Size = UDim2.fromOffset(
                    menuWidth + 8,
                    ContextMenu.Inner.Layout.AbsoluteContentSize.Y + 4
                );
            end;
            DisplayFrame:GetPropertyChangedSignal('AbsolutePosition'):Connect(updateMenuPosition);
            ContextMenu.Inner.Layout:GetPropertyChangedSignal('AbsoluteContentSize'):Connect(updateMenuSize);
            task.spawn(updateMenuPosition);
            task.spawn(updateMenuSize);
            Library:AddToRegistry(ContextMenu.Inner, {
                BackgroundColor3 = 'BackgroundColor';
                BorderColor3 = 'OutlineColor';
            });
            function ContextMenu:Show()
                self.Container.Visible = true;
            end;
            function ContextMenu:Hide()
                self.Container.Visible = false;
            end;
            function ContextMenu:AddOption(Str, Callback)
                if type(Callback) ~= 'function' then
                    Callback = function() end;
                end;
                local Button = Library:CreateLabel({
                    Active = false;
                    Size = UDim2.new(1, 0, 0, 15);
                    TextSize = 13;
                    Text = Str;
                    ZIndex = 16;
                    Parent = self.Inner;
                    TextXAlignment = Enum.TextXAlignment.Left,
                });
                Library:OnHighlight(Button, Button,
                    { TextColor3 = 'AccentColor' },
                    { TextColor3 = 'FontColor' }
                );
                Button.InputBegan:Connect(function(Input)
                    if (Input.UserInputType == Enum.UserInputType.MouseButton1 or (Library.IsMobile and Input.UserInputType == Enum.UserInputType.Touch)) then
                        Callback();
                    end;
                end);
            end;
            ContextMenu:AddOption('Copy color', function()
                Library.ColorClipboard = ColorPicker.Value;
                Library:Notify('Copied color!', 2);
            end);
            ContextMenu:AddOption('Paste color', function()
                if not Library.ColorClipboard then
                    return Library:Notify('You have not copied a color!', 2);
                end;
                ColorPicker:SetValueRGB(Library.ColorClipboard);
            end);
            ContextMenu:AddOption('Copy HEX', function()
                pcall(setclipboard, ColorPicker.Value:ToHex());
                Library:Notify('Copied hex code to clipboard!', 2);
            end);
            ContextMenu:AddOption('Copy RGB', function()
                pcall(setclipboard, table.concat({ math.floor(ColorPicker.Value.R * 255), math.floor(ColorPicker.Value.G * 255), math.floor(ColorPicker.Value.B * 255) }, ', '));
                Library:Notify('Copied RGB values to clipboard!', 2);
            end);
        end;
        Library:AddToRegistry(PickerFrameInner, { BackgroundColor3 = 'BackgroundColor'; BorderColor3 = 'OutlineColor'; });
        Library:AddToRegistry(Highlight, { BackgroundColor3 = 'AccentColor'; });
        Library:AddToRegistry(SatVibMapInner, { BackgroundColor3 = 'BackgroundColor'; BorderColor3 = 'OutlineColor'; });
        Library:AddToRegistry(HueBoxInner, { BackgroundColor3 = 'MainColor'; BorderColor3 = 'OutlineColor'; });
        Library:AddToRegistry(RgbBoxBase.Frame, { BackgroundColor3 = 'MainColor'; BorderColor3 = 'OutlineColor'; });
        Library:AddToRegistry(RgbBox, { TextColor3 = 'FontColor', });
        Library:AddToRegistry(HueBox, { TextColor3 = 'FontColor', });
        local SequenceTable = {};
        for Hue = 0, 1, 0.1 do
            table.insert(SequenceTable, ColorSequenceKeypoint.new(Hue, Color3.fromHSV(Hue, 1, 1)));
        end;
        local HueSelectorGradient = Library:Create('UIGradient', {
            Color = ColorSequence.new(SequenceTable);
            Rotation = 90;
            Parent = HueSelectorInner;
        });
        HueBox.FocusLost:Connect(function(enter)
            if enter then
                local success, result = pcall(Color3.fromHex, HueBox.Text);
                if success and typeof(result) == 'Color3' then
                    ColorPicker.Hue, ColorPicker.Sat, ColorPicker.Vib = Color3.toHSV(result);
                end;
            end;
            ColorPicker:Display();
        end);
        RgbBox.FocusLost:Connect(function(enter)
            if enter then
                local r, g, b = RgbBox.Text:match('(%d+),%s*(%d+),%s*(%d+)');
                if r and g and b then
                    ColorPicker.Hue, ColorPicker.Sat, ColorPicker.Vib = Color3.toHSV(Color3.fromRGB(r, g, b));
                end;
            end;
            ColorPicker:Display();
        end);
        function ColorPicker:Display()
            ColorPicker.Value = Color3.fromHSV(ColorPicker.Hue, ColorPicker.Sat, ColorPicker.Vib);
            SatVibMap.BackgroundColor3 = Color3.fromHSV(ColorPicker.Hue, 1, 1);
            Library:Create(DisplayFrame, {
                BackgroundColor3 = ColorPicker.Value;
                BackgroundTransparency = ColorPicker.Transparency;
                BorderColor3 = Library:GetDarkerColor(ColorPicker.Value);
            });
            if TransparencyBoxInner then
                TransparencyBoxInner.BackgroundColor3 = ColorPicker.Value;
                TransparencyCursor.Position = UDim2.new(1 - ColorPicker.Transparency, 0, 0, 0);
            end;
            CursorOuter.Position = UDim2.new(ColorPicker.Sat, 0, 1 - ColorPicker.Vib, 0);
            HueCursor.Position = UDim2.new(0, 0, ColorPicker.Hue, 0);
            HueBox.Text = '#' .. ColorPicker.Value:ToHex();
            RgbBox.Text = table.concat({ math.floor(ColorPicker.Value.R * 255), math.floor(ColorPicker.Value.G * 255), math.floor(ColorPicker.Value.B * 255) }, ', ');
            Library:SafeCallback(ColorPicker.Callback, ColorPicker.Value);
            Library:SafeCallback(ColorPicker.Changed, ColorPicker.Value);
        end;
        function ColorPicker:OnChanged(Func)
            ColorPicker.Changed = Func;
            Func(ColorPicker.Value);
        end;
        function ColorPicker:Show()
            for Frame, Val in next, Library.OpenedFrames do
                if Frame.Name == 'Color' then
                    Frame.Visible = false;
                    Library.OpenedFrames[Frame] = nil;
                end;
            end;
            PickerFrameOuter.Visible = true;
            Library.OpenedFrames[PickerFrameOuter] = true;
        end;
        function ColorPicker:Hide()
            PickerFrameOuter.Visible = false;
            Library.OpenedFrames[PickerFrameOuter] = nil;
        end;
        function ColorPicker:SetValue(HSV, Transparency)
            local Color = Color3.fromHSV(HSV[1], HSV[2], HSV[3]);
            ColorPicker.Transparency = Transparency or 0;
            ColorPicker:SetHSVFromRGB(Color);
            ColorPicker:Display();
        end;
        function ColorPicker:SetValueRGB(Color, Transparency)
            ColorPicker.Transparency = Transparency or 0;
            ColorPicker:SetHSVFromRGB(Color);
            ColorPicker:Display();
        end;
        local function HandleTouchInput(Input, Element, UpdateFunc)
            if Input.UserInputType == Enum.UserInputType.Touch then
                local MinX = Element.AbsolutePosition.X;
                local MaxX = MinX + Element.AbsoluteSize.X;
                local MinY = Element.AbsolutePosition.Y;
                local MaxY = MinY + Element.AbsoluteSize.Y;
                local TouchX = math.clamp(Input.Position.X, MinX, MaxX);
                local TouchY = math.clamp(Input.Position.Y, MinY, MaxY);
                UpdateFunc(TouchX, TouchY, MinX, MaxX, MinY, MaxY);
                return true;
            end;
            return false;
        end;
        SatVibMap.InputBegan:Connect(function(Input)
            if (Input.UserInputType == Enum.UserInputType.MouseButton1 or (Library.IsMobile and Input.UserInputType == Enum.UserInputType.Touch)) then
                local function UpdateSatVib(TouchX, TouchY, MinX, MaxX, MinY, MaxY)
                    ColorPicker.Sat = (TouchX - MinX) / (MaxX - MinX);
                    ColorPicker.Vib = 1 - ((TouchY - MinY) / (MaxY - MinY));
                    ColorPicker:Display();
                end;
                if HandleTouchInput(Input, SatVibMap, UpdateSatVib) or Input.UserInputType == Enum.UserInputType.MouseButton1 then
                    while (InputService:IsMouseButtonPressed(Enum.UserInputType.MouseButton1) or (Library.IsMobile and Input.UserInputType == Enum.UserInputType.Touch)) do
                        if Library.IsMobile then
                            for _, Touch in pairs(InputService:GetTouches()) do
                                if HandleTouchInput(Touch, SatVibMap, UpdateSatVib) then
                                    break;
                                end;
                            end;
                        else
                            UpdateSatVib(Mouse.X, Mouse.Y, SatVibMap.AbsolutePosition.X, SatVibMap.AbsolutePosition.X + SatVibMap.AbsoluteSize.X, SatVibMap.AbsolutePosition.Y, SatVibMap.AbsolutePosition.Y + SatVibMap.AbsoluteSize.Y);
                        end;
                        RenderStepped:Wait();
                    end;
                    Library:AttemptSave();
                end;
            end;
        end);
        HueSelectorInner.InputBegan:Connect(function(Input)
            if (Input.UserInputType == Enum.UserInputType.MouseButton1 or (Library.IsMobile and Input.UserInputType == Enum.UserInputType.Touch)) then
                local function UpdateHue(TouchX, TouchY, MinX, MaxX, MinY, MaxY)
                    ColorPicker.Hue = ((TouchY - MinY) / (MaxY - MinY));
                    ColorPicker:Display();
                end;
                if HandleTouchInput(Input, HueSelectorInner, UpdateHue) or Input.UserInputType == Enum.UserInputType.MouseButton1 then
                    while (InputService:IsMouseButtonPressed(Enum.UserInputType.MouseButton1) or (Library.IsMobile and Input.UserInputType == Enum.UserInputType.Touch)) do
                        if Library.IsMobile then
                            for _, Touch in pairs(InputService:GetTouches()) do
                                if HandleTouchInput(Touch, HueSelectorInner, UpdateHue) then
                                    break;
                                end;
                            end;
                        else
                            UpdateHue(Mouse.X, Mouse.Y, HueSelectorInner.AbsolutePosition.X, HueSelectorInner.AbsolutePosition.X + HueSelectorInner.AbsoluteSize.X, HueSelectorInner.AbsolutePosition.Y, HueSelectorInner.AbsolutePosition.Y + HueSelectorInner.AbsoluteSize.Y);
                        end;
                        RenderStepped:Wait();
                    end;
                    Library:AttemptSave();
                end;
            end;
        end);
        DisplayFrame.InputBegan:Connect(function(Input)
            if (Input.UserInputType == Enum.UserInputType.MouseButton1 or (Library.IsMobile and Input.UserInputType == Enum.UserInputType.Touch)) and not Library:MouseIsOverOpenedFrame() then
                if PickerFrameOuter.Visible then
                    ColorPicker:Hide();
                else
                    ContextMenu:Hide();
                    ColorPicker:Show();
                end;
            elseif Input.UserInputType == Enum.UserInputType.MouseButton2 and not Library:MouseIsOverOpenedFrame() then
                ContextMenu:Show();
                ColorPicker:Hide();
            end;
        end);
        if TransparencyBoxInner then
            TransparencyBoxInner.InputBegan:Connect(function(Input)
                if (Input.UserInputType == Enum.UserInputType.MouseButton1 or (Library.IsMobile and Input.UserInputType == Enum.UserInputType.Touch)) then
                    local function UpdateTransparency(TouchX, TouchY, MinX, MaxX, MinY, MaxY)
                        ColorPicker.Transparency = 1 - ((TouchX - MinX) / (MaxX - MinX));
                        ColorPicker:Display();
                    end;
                    if HandleTouchInput(Input, TransparencyBoxInner, UpdateTransparency) or Input.UserInputType == Enum.UserInputType.MouseButton1 then
                        while (InputService:IsMouseButtonPressed(Enum.UserInputType.MouseButton1) or (Library.IsMobile and Input.UserInputType == Enum.UserInputType.Touch)) do
                            if Library.IsMobile then
                                for _, Touch in pairs(InputService:GetTouches()) do
                                    if HandleTouchInput(Touch, TransparencyBoxInner, UpdateTransparency) then
                                        break;
                                    end;
                                end;
                            else
                                UpdateTransparency(Mouse.X, Mouse.Y, TransparencyBoxInner.AbsolutePosition.X, TransparencyBoxInner.AbsolutePosition.X + TransparencyBoxInner.AbsoluteSize.X, TransparencyBoxInner.AbsolutePosition.Y, TransparencyBoxInner.AbsolutePosition.Y + TransparencyBoxInner.AbsoluteSize.Y);
                            end;
                            RenderStepped:Wait();
                        end;
                        Library:AttemptSave();
                    end;
                end;
            end);
        end;
        Library:GiveSignal(InputService.InputBegan:Connect(function(Input)
            if Input.UserInputType == Enum.UserInputType.MouseButton1 or (Library.IsMobile and Input.UserInputType == Enum.UserInputType.Touch) then
                local AbsPos, AbsSize = PickerFrameOuter.AbsolutePosition, PickerFrameOuter.AbsoluteSize;
                local InputPos = Library.IsMobile and Input.Position or Vector2.new(Mouse.X, Mouse.Y);
                if InputPos.X < AbsPos.X or InputPos.X > AbsPos.X + AbsSize.X
                    or InputPos.Y < (AbsPos.Y - 20 - 1) or InputPos.Y > AbsPos.Y + AbsSize.Y then
                    ColorPicker:Hide();
                end;
                if not Library:IsMouseOverFrame(ContextMenu.Container) then
                    ContextMenu:Hide();
                end;
            end;
            if Input.UserInputType == Enum.UserInputType.MouseButton2 and ContextMenu.Container.Visible then
                if not Library:IsMouseOverFrame(ContextMenu.Container) and not Library:IsMouseOverFrame(DisplayFrame) then
                    ContextMenu:Hide();
                end;
            end;
        end));
        ColorPicker:Display();
        ColorPicker.DisplayFrame = DisplayFrame;
        Options[Idx] = ColorPicker;
        return self;
    end;
    function Funcs:AddKeyPicker(Idx, Info)
        local ParentObj = self;
        local ToggleLabel = self.TextLabel;
        local Container = self.Container;
        assert(Info.Default, 'AddKeyPicker: Missing default value.');
        local KeyPicker = {
            Value = Info.Default;
            Toggled = false;
            Mode = Info.Mode or 'Toggle';
            Type = 'KeyPicker';
            Callback = Info.Callback or function(Value) end;
            ChangedCallback = Info.ChangedCallback or function(New) end;
            SyncToggleState = Info.SyncToggleState or false;
        };
        if KeyPicker.SyncToggleState then
            Info.Modes = { 'Toggle' };
            Info.Mode = 'Toggle';
        end;
        local PickOuter = Library:Create('Frame', {
            BackgroundColor3 = Color3.new(0, 0, 0);
            BorderColor3 = Color3.new(0, 0, 0);
            Size = UDim2.new(0, 28, 0, 15);
            ZIndex = 6;
            Parent = ToggleLabel;
        });
        local PickInner = Library:Create('Frame', {
            BackgroundColor3 = Library.BackgroundColor;
            BorderColor3 = Library.OutlineColor;
            BorderMode = Enum.BorderMode.Inset;
            Size = UDim2.new(1, 0, 1, 0);
            ZIndex = 7;
            Parent = PickOuter;
        });
        Library:AddToRegistry(PickInner, {
            BackgroundColor3 = 'BackgroundColor';
            BorderColor3 = 'OutlineColor';
        });
        local DisplayLabel = Library:CreateLabel({
            Size = UDim2.new(1, 0, 1, 0);
            TextSize = 13;
            Text = Info.Default;
            TextWrapped = true;
            ZIndex = 8;
            Parent = PickInner;
        });
        local ModeSelectOuter = Library:Create('Frame', {
            BorderColor3 = Color3.new(0, 0, 0);
            Position = UDim2.fromOffset(ToggleLabel.AbsolutePosition.X + ToggleLabel.AbsoluteSize.X + 4, ToggleLabel.AbsolutePosition.Y + 1);
            Size = UDim2.new(0, 60, 0, 45 + 2);
            Visible = false;
            ZIndex = 14;
            Parent = ScreenGui;
        });
        ToggleLabel:GetPropertyChangedSignal('AbsolutePosition'):Connect(function()
            ModeSelectOuter.Position = UDim2.fromOffset(ToggleLabel.AbsolutePosition.X + ToggleLabel.AbsoluteSize.X + 4, ToggleLabel.AbsolutePosition.Y + 1);
        end);
        local ModeSelectInner = Library:Create('Frame', {
            BackgroundColor3 = Library.BackgroundColor;
            BorderColor3 = Library.OutlineColor;
            BorderMode = Enum.BorderMode.Inset;
            Size = UDim2.new(1, 0, 1, 0);
            ZIndex = 15;
            Parent = ModeSelectOuter;
        });
        Library:AddToRegistry(ModeSelectInner, {
            BackgroundColor3 = 'BackgroundColor';
            BorderColor3 = 'OutlineColor';
        });
        Library:Create('UIListLayout', {
            FillDirection = Enum.FillDirection.Vertical;
            SortOrder = Enum.SortOrder.LayoutOrder;
            Parent = ModeSelectInner;
        });
        local ContainerLabel = Library:CreateLabel({
            TextXAlignment = Enum.TextXAlignment.Left;
            Size = UDim2.new(1, 0, 0, 18);
            TextSize = 13;
            Visible = false;
            ZIndex = 110;
            Parent = Library.KeybindContainer;
        }, true);
        local Modes = Info.Modes or { 'Always', 'Toggle', 'Hold' };
        local ModeButtons = {};
        for Idx, Mode in next, Modes do
            local ModeButton = {};
            local Label = Library:CreateLabel({
                Active = false;
                Size = UDim2.new(1, 0, 0, 15);
                TextSize = 13;
                Text = Mode;
                ZIndex = 16;
                Parent = ModeSelectInner;
            });
            function ModeButton:Select()
                for _, Button in next, ModeButtons do
                    Button:Deselect();
                end;
                KeyPicker.Mode = Mode;
                Label.TextColor3 = Library.AccentColor;
                Library.RegistryMap[Label].Properties.TextColor3 = 'AccentColor';
                ModeSelectOuter.Visible = false;
            end;
            function ModeButton:Deselect()
                KeyPicker.Mode = nil;
                Label.TextColor3 = Library.FontColor;
                Library.RegistryMap[Label].Properties.TextColor3 = 'FontColor';
            end;
            Label.InputBegan:Connect(function(Input)
                if (Input.UserInputType == Enum.UserInputType.MouseButton1 or (Library.IsMobile and Input.UserInputType == Enum.UserInputType.Touch)) then
                    ModeButton:Select();
                    Library:AttemptSave();
                end;
            end);
            if Mode == KeyPicker.Mode then
                ModeButton:Select();
            end;
            ModeButtons[Mode] = ModeButton;
        end;
        function KeyPicker:Update()
            if Info.NoUI then
                return;
            end;
            local State = KeyPicker:GetState();
            ContainerLabel.Text = string.format('[%s] %s (%s)', KeyPicker.Value, Info.Text, KeyPicker.Mode);
            ContainerLabel.Visible = true;
            ContainerLabel.TextColor3 = State and Library.AccentColor or Library.FontColor;
            Library.RegistryMap[ContainerLabel].Properties.TextColor3 = State and 'AccentColor' or 'FontColor';
            local YSize = 0;
            local XSize = 0;
            for _, Label in next, Library.KeybindContainer:GetChildren() do
                if Label:IsA('TextLabel') and Label.Visible then
                    YSize = YSize + 18;
                    if (Label.TextBounds.X > XSize) then
                        XSize = Label.TextBounds.X;
                    end;
                end;
            end;
            Library.KeybindFrame.Size = UDim2.new(0, math.max(XSize + 10, 210), 0, YSize + 23);
        end;
        function KeyPicker:GetState()
            if KeyPicker.Mode == 'Always' then
                return true;
            elseif KeyPicker.Mode == 'Hold' then
                if KeyPicker.Value == 'None' then
                    return false;
                end;
                local Key = KeyPicker.Value;
                if Key == 'MB1' or Key == 'MB2' then
                    return Key == 'MB1' and InputService:IsMouseButtonPressed(Enum.UserInputType.MouseButton1)
                        or Key == 'MB2' and InputService:IsMouseButtonPressed(Enum.UserInputType.MouseButton2);
                else
                    return InputService:IsKeyDown(Enum.KeyCode[KeyPicker.Value]);
                end;
            else
                return KeyPicker.Toggled;
            end;
        end;
        function KeyPicker:SetValue(Data)
            local Key, Mode = Data[1], Data[2];
            DisplayLabel.Text = Key;
            KeyPicker.Value = Key;
            ModeButtons[Mode]:Select();
            KeyPicker:Update();
        end;
        function KeyPicker:OnClick(Callback)
            KeyPicker.Clicked = Callback;
        end;
        function KeyPicker:OnChanged(Callback)
            KeyPicker.Changed = Callback;
            Callback(KeyPicker.Value);
        end;
        if ParentObj.Addons then
            table.insert(ParentObj.Addons, KeyPicker);
        end;
        function KeyPicker:DoClick()
            if ParentObj.Type == 'Toggle' and KeyPicker.SyncToggleState then
                ParentObj:SetValue(not ParentObj.Value);
            end;
            Library:SafeCallback(KeyPicker.Callback, KeyPicker.Toggled);
            Library:SafeCallback(KeyPicker.Clicked, KeyPicker.Toggled);
        end;
        local Picking = false;
        PickOuter.InputBegan:Connect(function(Input)
            if (Input.UserInputType == Enum.UserInputType.MouseButton1 or (Library.IsMobile and Input.UserInputType == Enum.UserInputType.Touch)) and not Library:MouseIsOverOpenedFrame() then
                Picking = true;
                DisplayLabel.Text = '';
                local Break;
                local Text = '';
                task.spawn(function()
                    while (not Break) do
                        if Text == '...' then
                            Text = '';
                        end;
                        Text = Text .. '.';
                        DisplayLabel.Text = Text;
                        wait(0.4);
                    end;
                end);
                wait(0.2);
                local Event;
                Event = InputService.InputBegan:Connect(function(Input)
                    local Key;
                    if Input.UserInputType == Enum.UserInputType.Keyboard then
                        Key = Input.KeyCode.Name;
                    elseif Input.UserInputType == Enum.UserInputType.MouseButton1 then
                        Key = 'MB1';
                    elseif Input.UserInputType == Enum.UserInputType.MouseButton2 then
                        Key = 'MB2';
                    elseif Library.IsMobile and Input.UserInputType == Enum.UserInputType.Touch then
                        Key = 'Touch';
                    end;
                    Break = true;
                    Picking = false;
                    DisplayLabel.Text = Key;
                    KeyPicker.Value = Key;
                    Library:SafeCallback(KeyPicker.ChangedCallback, Input.KeyCode or Input.UserInputType);
                    Library:SafeCallback(KeyPicker.Changed, Input.KeyCode or Input.UserInputType);
                    Library:AttemptSave();
                    Event:Disconnect();
                end);
            elseif Input.UserInputType == Enum.UserInputType.MouseButton2 and not Library:MouseIsOverOpenedFrame() then
                ModeSelectOuter.Visible = true;
            end;
        end);
        Library:GiveSignal(InputService.InputBegan:Connect(function(Input)
            if (not Picking) then
                if KeyPicker.Mode == 'Toggle' then
                    local Key = KeyPicker.Value;
                    if Key == 'MB1' or Key == 'MB2' then
                        if Key == 'MB1' and Input.UserInputType == Enum.UserInputType.MouseButton1
                        or Key == 'MB2' and Input.UserInputType == Enum.UserInputType.MouseButton2 then
                            KeyPicker.Toggled = not KeyPicker.Toggled;
                            KeyPicker:DoClick();
                        end;
                    elseif Input.UserInputType == Enum.UserInputType.Keyboard then
                        if Input.KeyCode.Name == Key then
                            KeyPicker.Toggled = not KeyPicker.Toggled;
                            KeyPicker:DoClick();
                        end;
                    elseif Library.IsMobile and Input.UserInputType == Enum.UserInputType.Touch and Key == 'Touch' then
                        KeyPicker.Toggled = not KeyPicker.Toggled;
                        KeyPicker:DoClick();
                    end;
                end;
                KeyPicker:Update();
            end;
            if Input.UserInputType == Enum.UserInputType.MouseButton1 or (Library.IsMobile and Input.UserInputType == Enum.UserInputType.Touch) then
                local AbsPos, AbsSize = ModeSelectOuter.AbsolutePosition, ModeSelectOuter.AbsoluteSize;
                local InputPos = Library.IsMobile and Input.Position or Vector2.new(Mouse.X, Mouse.Y);
                if InputPos.X < AbsPos.X or InputPos.X > AbsPos.X + AbsSize.X
                    or InputPos.Y < (AbsPos.Y - 20 - 1) or InputPos.Y > AbsPos.Y + AbsSize.Y then
                    ModeSelectOuter.Visible = false;
                end;
            end;
        end));
        Library:GiveSignal(InputService.InputEnded:Connect(function(Input)
            if (not Picking) then
                KeyPicker:Update();
            end;
        end));
        KeyPicker:Update();
        Options[Idx] = KeyPicker;
        return self;
    end;
    BaseAddons.__index = Funcs;
    BaseAddons.__namecall = function.Table, Key, ...)
        return Funcs[Key](...);
    end;
end;
local BaseGroupbox = {};
do
    local Funcs = {};
    function Funcs:AddBlank(Size)
        local Groupbox = self;
        local Container = Groupbox.Container;
        Library:Create('Frame', {
            BackgroundTransparency = 1;
            Size = UDim2.new(1, 0, 0, Size);
            ZIndex = 1;
            Parent = Container;
        });
    end;
    function Funcs:AddLabel(Text, DoesWrap)
        local Label = {};
        local Groupbox = self;
        local Container = Groupbox.Container;
        local TextLabel = Library:CreateLabel({
            Size = UDim2.new(1, -4, 0, 15);
            TextSize = 14;
            Text = Text;
            TextWrapped = DoesWrap or false,
            TextXAlignment = Enum.TextXAlignment.Left;
            ZIndex = 5;
            Parent = Container;
        });
        if DoesWrap then
            local Y = select(2, Library:GetTextBounds(Text, Library.Font, 14, Vector2.new(TextLabel.AbsoluteSize.X, math.huge)));
            TextLabel.Size = UDim2.new(1, -4, 0, Y);
        else
            Library:Create('UIListLayout', {
                Padding = UDim.new(0, 4);
                FillDirection = Enum.FillDirection.Horizontal;
                HorizontalAlignment = Enum.HorizontalAlignment.Right;
                SortOrder = Enum.SortOrder.LayoutOrder;
                Parent = TextLabel;
            });
        end;
        Label.TextLabel = TextLabel;
        Label.Container = Container;
        function Label:SetText(Text)
            TextLabel.Text = Text;
            if DoesWrap then
                local Y = select(2, Library:GetTextBounds(Text, Library.Font, 14, Vector2.new(TextLabel.AbsoluteSize.X, math.huge)));
                TextLabel.Size = UDim2.new(1, -4, 0, Y);
            end;
            Groupbox:Resize();
        end;
        if (not DoesWrap) then
            setmetatable(Label, BaseAddons);
        end;
        Groupbox:AddBlank(5);
        Groupbox:Resize();
        return Label;
    end;
    function Funcs:AddButton(...)
        local Button = {};
        local function ProcessButtonParams(Class, Obj, ...)
            local Props = select(1, ...);
            if type(Props) == 'table' then
                Obj.Text = Props.Text;
                Obj.Func = Props.Func;
                Obj.DoubleClick = Props.DoubleClick;
                Obj.Tooltip = Props.Tooltip;
            else
                Obj.Text = select(1, ...);
                Obj.Func = select(2, ...);
            end;
            assert(type(Obj.Func) == 'function', 'AddButton: `Func` callback is missing.');
        end;
        ProcessButtonParams('Button', Button, ...);
        local Groupbox = self;
        local Container = Groupbox.Container;
        local function CreateBaseButton(Button)
            local Outer = Library:Create('Frame', {
                BackgroundColor3 = Color3.new(0, 0, 0);
                BorderColor3 = Color3.new(0, 0, 0);
                Size = UDim2.new(1, -4, 0, 20);
                ZIndex = 5;
            });
            local Inner = Library:Create('Frame', {
                BackgroundColor3 = Library.MainColor;
                BorderColor3 = Library.OutlineColor;
                BorderMode = Enum.BorderMode.Inset;
                Size = UDim2.new(1, 0, 1, 0);
                ZIndex = 6;
                Parent = Outer;
            });
            local Label = Library:CreateLabel({
                Size = UDim2.new(1, 0, 1, 0);
                TextSize = 14;
                Text = Button.Text;
                ZIndex = 6;
                Parent = Inner;
            });
            Library:Create('UIGradient', {
                Color = ColorSequence.new({
                    ColorSequenceKeypoint.new(0, Color3.new(1, 1, 1)),
                    ColorSequenceKeypoint.new(1, Color3.fromRGB(212, 212, 212))
                });
                Rotation = 90;
                Parent = Inner;
            });
            Library:AddToRegistry(Outer, {
                BorderColor3 = 'Black';
            });
            Library:AddToRegistry(Inner, {
                BackgroundColor3 = 'MainColor';
                BorderColor3 = 'OutlineColor';
            });
            Library:OnHighlight(Outer, Outer,
                { BorderColor3 = 'AccentColor' },
                { BorderColor3 = 'Black' }
            );
            return Outer, Inner, Label;
        end;
        local function InitEvents(Button)
            local function WaitForEvent(event, timeout, validator)
                local bindable = Instance.new('BindableEvent');
                local connection = event:Once(function(...)
                    if type(validator) == 'function' and validator(...) then
                        bindable:Fire(true);
                    else
                        bindable:Fire(false);
                    end;
                end);
                task.delay(timeout, function()
                    connection:disconnect();
                    bindable:Fire(false);
                end);
                return bindable.Event:Wait();
            end;
            local function ValidateClick(Input)
                if Library:MouseIsOverOpenedFrame() then
                    return false;
                end;
                if Input.UserInputType ~= Enum.UserInputType.MouseButton1 and (not Library.IsMobile or Input.UserInputType ~= Enum.UserInputType.Touch) then
                    return false;
                end;
                return true;
            end;
            Button.Outer.InputBegan:Connect(function(Input)
                if not ValidateClick(Input) then return end;
                if Button.Locked then return end;
                if Button.DoubleClick then
                    Library:RemoveFromRegistry(Button.Label);
                    Library:AddToRegistry(Button.Label, { TextColor3 = 'AccentColor' });
                    Button.Label.TextColor3 = Library.AccentColor;
                    Button.Label.Text = 'Are you sure?';
                    Button.Locked = true;
                    local clicked = WaitForEvent(Button.Outer.InputBegan, 0.5, ValidateClick);
                    Library:RemoveFromRegistry(Button.Label);
                    Library:AddToRegistry(Button.Label, { TextColor3 = 'FontColor' });
                    Button.Label.TextColor3 = Library.FontColor;
                    Button.Label.Text = Button.Text;
                    task.defer(rawset, Button, 'Locked', false);
                    if clicked then
                        Library:SafeCallback(Button.Func);
                    end;
                    return;
                end;
                Library:SafeCallback(Button.Func);
            end);
        end;
        Button.Outer, Button.Inner, Button.Label = CreateBaseButton(Button);
        Button.Outer.Parent = Container;
        InitEvents(Button);
        function Button:AddTooltip(tooltip)
            if type(tooltip) == 'string' then
                Library:AddToolTip(tooltip, self.Outer);
            end;
            return self;
        end;
        function Button:AddButton(...)
            local SubButton = {};
            ProcessButtonParams('SubButton', SubButton, ...);
            self.Outer.Size = UDim2.new(0.5, -2, 0, 20);
            SubButton.Outer, SubButton.Inner, SubButton.Label = CreateBaseButton(SubButton);
            SubButton.Outer.Position = UDim2.new(1, 3, 0, 0);
            SubButton.Outer.Size = UDim2.fromOffset(self.Outer.AbsoluteSize.X - 2, self.Outer.AbsoluteSize.Y);
            SubButton.Outer.Parent = self.Outer;
            function SubButton:AddTooltip(tooltip)
                if type(tooltip) == 'string' then
                    Library:AddToolTip(tooltip, self.Outer);
                end;
                return SubButton;
            end;
            if type(SubButton.Tooltip) == 'string' then
                SubButton:AddTooltip(SubButton.Tooltip);
            end;
            InitEvents(SubButton);
            return SubButton;
        end;
        if type(Button.Tooltip) == 'string' then
            Button:AddTooltip(Button.Tooltip);
        end;
        Groupbox:AddBlank(5);
        Groupbox:Resize();
        return Button;
    end;
    function Funcs:AddDivider()
        local Groupbox = self;
        local Container = self.Container;
        local Divider = {
            Type = 'Divider',
        };
        Groupbox:AddBlank(2);
        local DividerOuter = Library:Create('Frame', {
            BackgroundColor3 = Color3.new(0, 0, 0);
            BorderColor3 = Color3.new(0, 0, 0);
            Size = UDim2.new(1, -4, 0, 5);
            ZIndex = 5;
            Parent = Container;
        });
        local DividerInner = Library:Create('Frame', {
            BackgroundColor3 = Library.MainColor;
            BorderColor3 = Library.OutlineColor;
            BorderMode = Enum.BorderMode.Inset;
            Size = UDim2.new(1, 0, 1, 0);
            ZIndex = 6;
            Parent = DividerOuter;
        });
        Library:AddToRegistry(DividerOuter, {
            BorderColor3 = 'Black';
        });
        Library:AddToRegistry(DividerInner, {
            BackgroundColor3 = 'MainColor';
            BorderColor3 = 'OutlineColor';
        });
        Groupbox:AddBlank(9);
        Groupbox:Resize();
    end;
    function Funcs:AddInput(Idx, Info)
        assert(Info.Text, 'AddInput: Missing `Text` string.');
        local Textbox = {
            Value = Info.Default or '';
            Numeric = Info.Numeric or false;
            Finished = Info.Finished or false;
            Type = 'Input';
            Callback = Info.Callback or function(Value) end;
        };
        local Groupbox = self;
        local Container = Groupbox.Container;
        local InputLabel = Library:CreateLabel({
            Size = UDim2.new(1, 0, 0, 15);
            TextSize = 14;
            Text = Info.Text;
            TextXAlignment = Enum.TextXAlignment.Left;
            ZIndex = 5;
            Parent = Container;
        });
        Groupbox:AddBlank(1);
        local TextBoxOuter = Library:Create('Frame', {
            BackgroundColor3 = Color3.new(0, 0, 0);
            BorderColor3 = Color3.new(0, 0, 0);
            Size = UDim2.new(1, -4, 0, 20);
            ZIndex = 5;
            Parent = Container;
        });
        local TextBoxInner = Library:Create('Frame', {
            BackgroundColor3 = Library.MainColor;
            BorderColor3 = Library.OutlineColor;
            BorderMode = Enum.BorderMode.Inset;
            Size = UDim2.new(1, 0, 1, 0);
            ZIndex = 6;
            Parent = TextBoxOuter;
        });
        Library:AddToRegistry(TextBoxInner, {
            BackgroundColor3 = 'MainColor';
            BorderColor3 = 'OutlineColor';
        });
        Library:OnHighlight(TextBoxOuter, TextBoxOuter,
            { BorderColor3 = 'AccentColor' },
            { BorderColor3 = 'Black' }
        );
        if type(Info.Tooltip) == 'string' then
            Library:AddToolTip(Info.Tooltip, TextBoxOuter);
        end;
        Library:Create('UIGradient', {
            Color = ColorSequence.new({
                ColorSequenceKeypoint.new(0, Color3.new(1, 1, 1)),
                ColorSequenceKeypoint.new(1, Color3.fromRGB(212, 212, 212))
            });
            Rotation = 90;
            Parent = TextBoxInner;
        });
        local Container = Library:Create('Frame', {
            BackgroundTransparency = 1;
            ClipsDescendants = true;
            Position = UDim2.new(0, 5, 0, 0);
            Size = UDim2.new(1, -5, 1, 0);
            ZIndex = 7;
            Parent = TextBoxInner;
        });
        local Box = Library:Create('TextBox', {
            BackgroundTransparency = 1;
            Position = UDim2.fromOffset(0, 0),
            Size = UDim2.fromScale(5, 1),
            Font = Library.Font;
            PlaceholderColor3 = Color3.fromRGB(190, 190, 190);
            PlaceholderText = Info.Placeholder or '';
            Text = Info.Default or '';
            TextColor3 = Library.FontColor;
            TextSize = 14;
            TextStrokeTransparency = 0;
            TextXAlignment = Enum.TextXAlignment.Left;
            ZIndex = 7;
            Parent = Container;
        });
        Library:ApplyTextStroke(Box);
        function Textbox:SetValue(Text)
            if Info.MaxLength and #Text > Info.MaxLength then
                Text = Text:sub(1, Info.MaxLength);
            end;
            if Textbox.Numeric then
                if (not tonumber(Text)) and Text:len() > 0 then
                    Text = Textbox.Value;
                end;
            end;
            Textbox.Value = Text;
            Box.Text = Text;
            Library:SafeCallback(Textbox.Callback, Textbox.Value);
            Library:SafeCallback(Textbox.Changed, Textbox.Value);
        end;
        if Textbox.Finished then
            Box.FocusLost:Connect(function(enter)
                if not enter then return end;
                Textbox:SetValue(Box.Text);
                Library:AttemptSave();
            end);
        else
            Box:GetPropertyChangedSignal('Text'):Connect(function()
                Textbox:SetValue(Box.Text);
                Library:AttemptSave();
            end);
        end;
        local function Update()
            local PADDING = 2;
            local reveal = Container.AbsoluteSize.X;
            if not Box:IsFocused() or Box.TextBounds.X <= reveal - 2 * PADDING then
                Box.Position = UDim2.new(0, PADDING, 0, 0);
            else
                local cursor = Box.CursorPosition;
                if cursor ~= -1 then
                    local subtext = string.sub(Box.Text, 1, cursor-1);
                    local width = TextService:GetTextSize(subtext, Box.TextSize, Box.Font, Vector2.new(math.huge, math.huge)).X;
                    local currentCursorPos = Box.Position.X.Offset + width;
                    if currentCursorPos < PADDING then
                        Box.Position = UDim2.fromOffset(PADDING-width, 0);
                    elseif currentCursorPos > reveal - PADDING - 1 then
                        Box.Position = UDim2.fromOffset(reveal-width-PADDING-1, 0);
                    end;
                end;
            end;
        end;
        task.spawn(Update);
        Box:GetPropertyChangedSignal('Text'):Connect(Update);
        Box:GetPropertyChangedSignal('CursorPosition'):Connect(Update);
        Box.FocusLost:Connect(Update);
        Box.Focused:Connect(Update);
        Library:AddToRegistry(Box, {
            TextColor3 = 'FontColor';
        });
        function Textbox:OnChanged(Func)
            Textbox.Changed = Func;
            Func(Textbox.Value);
        end;
        Groupbox:AddBlank(5);
        Groupbox:Resize();
        Options[Idx] = Textbox;
        return Textbox;
    end;
    function Funcs:AddToggle(Idx, Info)
        assert(Info.Text, 'AddInput: Missing `Text` string.');
        local Toggle = {
            Value = Info.Default or false;
            Type = 'Toggle';
            Callback = Info.Callback or function(Value) end;
            Addons = {},
            Risky = Info.Risky,
        };
        local Groupbox = self;
        local Container = Groupbox.Container;
        local ToggleOuter = Library:Create('Frame', {
            BackgroundColor3 = Color3.new(0, 0, 0);
            BorderColor3 = Color3.new(0, 0, 0);
            Size = UDim2.new(0, 13, 0, 13);
            ZIndex = 5;
            Parent = Container;
        });
        Library:AddToRegistry(ToggleOuter, {
            BorderColor3 = 'Black';
        });
        local ToggleInner = Library:Create('Frame', {
            BackgroundColor3 = Library.MainColor;
            BorderColor3 = Library.OutlineColor;
            BorderMode = Enum.BorderMode.Inset;
            Size = UDim2.new(1, 0, 1, 0);
            ZIndex = 6;
            Parent = ToggleOuter;
        });
        Library:AddToRegistry(ToggleInner, {
            BackgroundColor3 = 'MainColor';
            BorderColor3 = 'OutlineColor';
        });
        local ToggleLabel = Library:CreateLabel({
            Size = UDim2.new(0, 216, 1, 0);
            Position = UDim2.new(1, 6, 0, 0);
            TextSize = 14;
            Text = Info.Text;
            TextXAlignment = Enum.TextXAlignment.Left;
            ZIndex = 6;
            Parent = ToggleInner;
        });
        Library:Create('UIListLayout', {
            Padding = UDim.new(0, 4);
            FillDirection = Enum.FillDirection.Horizontal;
            HorizontalAlignment = Enum.HorizontalAlignment.Right;
            SortOrder = Enum.SortOrder.LayoutOrder;
            Parent = ToggleLabel;
        });
        local ToggleRegion = Library:Create('Frame', {
            BackgroundTransparency = 1;
            Size = UDim2.new(0, 170, 1, 0);
            ZIndex = 8;
            Parent = ToggleOuter;
        });
        Library:OnHighlight(ToggleRegion, ToggleOuter,
            { BorderColor3 = 'AccentColor' },
            { BorderColor3 = 'Black' }
        );
        function Toggle:UpdateColors()
            Toggle:Display();
        end;
        if type(Info.Tooltip) == 'string' then
            Library:AddToolTip(Info.Tooltip, ToggleRegion);
        end;
        function Toggle:Display()
            ToggleInner.BackgroundColor3 = Toggle.Value and Library.AccentColor or Library.MainColor;
            ToggleInner.BorderColor3 = Toggle.Value and Library.AccentColorDark or Library.OutlineColor;
            Library.RegistryMap[ToggleInner].Properties.BackgroundColor3 = Toggle.Value and 'AccentColor' or 'MainColor';
            Library.RegistryMap[ToggleInner].Properties.BorderColor3 = Toggle.Value and 'AccentColorDark' or 'OutlineColor';
        end;
        function Toggle:OnChanged(Func)
            Toggle.Changed = Func;
            Func(Toggle.Value);
        end;
        function Toggle:SetValue(Bool)
            Bool = (not not Bool);
            Toggle.Value = Bool;
            Toggle:Display();
            for _, Addon in next, Toggle.Addons do
                if Addon.Type == 'KeyPicker' and Addon.SyncToggleState then
                    Addon.Toggled = Bool;
                    Addon:Update();
                end;
            end;
            Library:SafeCallback(Toggle.Callback, Toggle.Value);
            Library:SafeCallback(Toggle.Changed, Toggle.Value);
            Library:UpdateDependencyBoxes();
        end;
        ToggleRegion.InputBegan:Connect(function(Input)
            if (Input.UserInputType == Enum.UserInputType.MouseButton1 or (Library.IsMobile and Input.UserInputType == Enum.UserInputType.Touch)) and not Library:MouseIsOverOpenedFrame() then
                Toggle:SetValue(not Toggle.Value);
                Library:AttemptSave();
            end;
        end);
        if Toggle.Risky then
            Library:RemoveFromRegistry(ToggleLabel);
            ToggleLabel.TextColor3 = Library.RiskColor;
            Library:AddToRegistry(ToggleLabel, { TextColor3 = 'RiskColor' });
        end;
        Toggle:Display();
        Groupbox:AddBlank(Info.BlankSize or 5 + 2);
        Groupbox:Resize();
        Toggle.TextLabel = ToggleLabel;
        Toggle.Container = Container;
        setmetatable(Toggle, BaseAddons);
        Toggles[Idx] = Toggle;
        Library:UpdateDependencyBoxes();
        return Toggle;
    end;
function Funcs:AddSlider(Idx, Info)
    assert(Info.Default, 'AddSlider: Missing default value.');
    assert(Info.Text, 'AddSlider: Missing slider text.');
    assert(Info.Min, 'AddSlider: Missing minimum value.');
    assert(Info.Max, 'AddSlider: Missing maximum value.');
    assert(Info.Rounding, 'AddSlider: Missing rounding value.');
    local Slider = {
        Value = Info.Default;
        Min = Info.Min;
        Max = Info.Max;
        Rounding = Info.Rounding;
        MaxSize = 232;
        Type = 'Slider';
        Callback = Info.Callback or function(Value) end;
    };
    local Groupbox = self;
    local Container = Groupbox.Container;
    if not Info.Compact then
        Library:CreateLabel({
            Size = UDim2.new(1, 0, 0, 10);
            TextSize = 14;
            Text = Info.Text;
            TextXAlignment = Enum.TextXAlignment.Left;
            TextYAlignment = Enum.TextYAlignment.Top;
            ZIndex = 5;
            Parent = Container;
        });
        Groupbox:AddBlank(3);
    end;
    local SliderOuter = Library:Create('Frame', {
        BackgroundColor3 = Color3.new(0, 0, 0);
        BorderColor3 = Color3.new(0, 0, 0);
        Size = UDim2.new(1, -4, 0, 13);
        ZIndex = 5;
        Parent = Container;
    });
    Library:AddToRegistry(SliderOuter, {
        BorderColor3 = 'Black';
    });
    local SliderInner = Library:Create('Frame', {
        BackgroundColor3 = Library.MainColor;
        BorderColor3 = Library.OutlineColor;
        BorderMode = Enum.BorderMode.Inset;
        Size = UDim2.new(1, 0, 1, 0);
        ZIndex = 6;
        Parent = SliderOuter;
    });
    Library:AddToRegistry(SliderInner, {
        BackgroundColor3 = 'MainColor';
        BorderColor3 = 'OutlineColor';
    });
    local Fill = Library:Create('Frame', {
        BackgroundColor3 = Library.AccentColor;
        BorderColor3 = Library.AccentColorDark;
        Size = UDim2.new(0, 0, 1, 0);
        ZIndex = 7;
        Parent = SliderInner;
    });
    Library:AddToRegistry(Fill, {
        BackgroundColor3 = 'AccentColor';
        BorderColor3 = 'AccentColorDark';
    });
    local FillGradient = Library:Create('UIGradient', {
        Color = ColorSequence.new({
            ColorSequenceKeypoint.new(0, Color3.new(1, 1, 1)),
            ColorSequenceKeypoint.new(1, Color3.fromRGB(212, 212, 212))
        });
        Rotation = 90;
        Parent = Fill;
    });
    local DisplayLabel = Library:CreateLabel({
        Size = UDim2.new(1, 0, 1, 0);
        TextSize = 13;
        Text = '0';
        ZIndex = 6;
        Parent = SliderInner;
    });
    local CustomValue = Library:Create('TextBox', {
        BackgroundTransparency = 1;
        Size = UDim2.new(0, 100, 0, 20);
        Position = UDim2.new(1, -110, 0, -10);
        TextColor3 = Library.FontColor;
        TextSize = 14;
        TextXAlignment = Enum.TextXAlignment.Right;
        ZIndex = 6;
        Parent = SliderInner;
    });
    Library:ApplyTextStroke(CustomValue);
    Library:AddToRegistry(CustomValue, { TextColor3 = 'FontColor' });
    if type(Info.Tooltip) == 'string' then
        Library:AddToolTip(Info.Tooltip, SliderOuter);
    end;
    function Slider:Update()
        local Percent = (Slider.Value - Slider.Min) / (Slider.Max - Slider.Min);
        local Size = math.floor(Slider.MaxSize * Percent);
        Fill.Size = UDim2.new(0, Size, 1, 0);
        DisplayLabel.Text = string.format('%.2f', Slider.Value);
        CustomValue.Text = string.format('%.2f', Slider.Value);
        Library:SafeCallback(Slider.Callback, Slider.Value);
        Library:SafeCallback(Slider.Changed, Slider.Value);
    end;
    function Slider:OnChanged(Func)
        Slider.Changed = Func;
        Func(Slider.Value);
    end;
    function Slider:SetValue(Value)
        Value = math.clamp(Value, Slider.Min, Slider.Max);
        Value = math.round(Value * (10 ^ Slider.Rounding)) / (10 ^ Slider.Rounding);
        Slider.Value = Value;
        Slider:Update();
    end;
    CustomValue.FocusLost:Connect(function()
        local Value = tonumber(CustomValue.Text);
        if Value then
            Slider:SetValue(Value);
            Library:AttemptSave();
        end;
    end);
    local function HandleTouchInput(Input, Element, UpdateFunc)
        if Input.UserInputType == Enum.UserInputType.Touch then
            local MinX = Element.AbsolutePosition.X;
            local MaxX = MinX + Element.AbsoluteSize.X;
            local TouchX = math.clamp(Input.Position.X, MinX, MaxX);
            UpdateFunc(TouchX, MinX, MaxX);
            return true;
        end;
        return false;
    end;
    SliderInner.InputBegan:Connect(function(Input)
        if (Input.UserInputType == Enum.UserInputType.MouseButton1 or (Library.IsMobile and Input.UserInputType == Enum.UserInputType.Touch)) and not Library:MouseIsOverOpenedFrame() then
            local function UpdateSlider(TouchX, MinX, MaxX)
                local Percent = (TouchX - MinX) / (MaxX - MinX);
                local Value = Slider.Min + (Slider.Max - Slider.Min) * Percent;
                Slider:SetValue(Value);
            end;
            if HandleTouchInput(Input, SliderInner, UpdateSlider) or Input.UserInputType == Enum.UserInputType.MouseButton1 then
                while (InputService:IsMouseButtonPressed(Enum.UserInputType.MouseButton1) or (Library.IsMobile and Input.UserInputType == Enum.UserInputType.Touch)) do
                    if Library.IsMobile then
                        for _, Touch in pairs(InputService:GetTouches()) do
                            if HandleTouchInput(Touch, SliderInner, UpdateSlider) then
                                break;
                            end;
                        end;
                    else
                        UpdateSlider(Mouse.X, SliderInner.AbsolutePosition.X, SliderInner.AbsolutePosition.X + SliderInner.AbsoluteSize.X);
                    end;
                    RenderStepped:Wait();
                end;
                Library:AttemptSave();
            end;
        end;
    end);
    Slider:Update();
    Groupbox:AddBlank(5);
    Groupbox:Resize();
    Options[Idx] = Slider;
    return Slider;
end;
function Funcs:AddDropdown(Idx, Info)
    assert(Info.Text, 'AddDropdown: Missing dropdown text.');
    assert(Info.Default, 'AddDropdown: Missing default value.');
    local Dropdown = {
        Values = Info.Values or {};
        Value = Info.Default;
        Multi = Info.Multi or false;
        Type = 'Dropdown';
        Callback = Info.Callback or function(Value) end;
    };
    local Groupbox = self;
    local Container = Groupbox.Container;
    local DropdownLabel = Library:CreateLabel({
        Size = UDim2.new(1, 0, 0, 10);
        TextSize = 14;
        Text = Info.Text;
        TextXAlignment = Enum.TextXAlignment.Left;
        ZIndex = 5;
        Parent = Container;
    });
    Groupbox:AddBlank(1);
    local DropdownOuter = Library:Create('Frame', {
        BackgroundColor3 = Color3.new(0, 0, 0);
        BorderColor3 = Color3.new(0, 0, 0);
        Size = UDim2.new(1, -4, 0, 20);
        ZIndex = 5;
        Parent = Container;
    });
    local DropdownInner = Library:Create('Frame', {
        BackgroundColor3 = Library.MainColor;
        BorderColor3 = Library.OutlineColor;
        BorderMode = Enum.BorderMode.Inset;
        Size = UDim2.new(1, 0, 1, 0);
        ZIndex = 6;
        Parent = DropdownOuter;
    });
    Library:AddToRegistry(DropdownInner, {
        BackgroundColor3 = 'MainColor';
        BorderColor3 = 'OutlineColor';
    });
    Library:OnHighlight(DropdownOuter, DropdownOuter,
        { BorderColor3 = 'AccentColor' },
        { BorderColor3 = 'Black' }
    );
    if type(Info.Tooltip) == 'string' then
        Library:AddToolTip(Info.Tooltip, DropdownOuter);
    end;
    local DisplayLabel = Library:CreateLabel({
        Size = UDim2.new(1, -5, 1, 0);
        TextSize = 14;
        Text = Dropdown.Value or '--';
        TextXAlignment = Enum.TextXAlignment.Left;
        ZIndex = 7;
        Parent = DropdownInner;
    });
    local DropdownFrame = Library:Create('Frame', {
        BackgroundColor3 = Color3.new(0, 0, 0);
        BorderColor3 = Color3.new(0, 0, 0);
        Position = UDim2.new(0, 0, 0, 20);
        Size = UDim2.new(1, 0, 0, 0);
        Visible = false;
        ZIndex = 9;
        Parent = DropdownOuter;
    });
    local DropdownInnerFrame = Library:Create('Frame', {
        BackgroundColor3 = Library.MainColor;
        BorderColor3 = Library.OutlineColor;
        BorderMode = Enum.BorderMode.Inset;
        Size = UDim2.new(1, 0, 1, 0);
        ZIndex = 10;
        Parent = DropdownFrame;
    });
    Library:AddToRegistry(DropdownInnerFrame, {
        BackgroundColor3 = 'MainColor';
        BorderColor3 = 'OutlineColor';
    });
    local ScrollingFrame = Library:Create('ScrollingFrame', {
        BackgroundTransparency = 1;
        BorderSizePixel = 0;
        Size = UDim2.new(1, 0, 1, 0);
        ZIndex = 11;
        Parent = DropdownInnerFrame;
        CanvasSize = UDim2.new(0, 0, 0, 0);
        ScrollBarThickness = 4;
        ScrollBarImageColor3 = Library.AccentColor;
    });
    Library:AddToRegistry(ScrollingFrame, { ScrollBarImageColor3 = 'AccentColor' });
    local Layout = Library:Create('UIListLayout', {
        SortOrder = Enum.SortOrder.LayoutOrder;
        Parent = ScrollingFrame;
    });
    function Dropdown:Update()
        DisplayLabel.Text = Dropdown.Value and tostring(Dropdown.Value) or '--';
        if Dropdown.Multi then
            local Values = {};
            for Value, Bool in next, Dropdown.Value do
                if Bool then
                    table.insert(Values, Value);
                end;
            end;
            DisplayLabel.Text = #Values > 0 and table.concat(Values, ', ') or '--';
        end;
        ScrollingFrame.CanvasSize = UDim2.new(0, 0, 0, Layout.AbsoluteContentSize.Y);
        Library:SafeCallback(Dropdown.Callback, Dropdown.Value);
        Library:SafeCallback(Dropdown.Changed, Dropdown.Value);
    end;
    function Dropdown:SetValue(Value)
        if Dropdown.Multi then
            Dropdown.Value = Value or {};
        else
            Dropdown.Value = Value;
        end;
        Dropdown:Update();
        Library:AttemptSave();
    end;
    function Dropdown:OnChanged(Func)
        Dropdown.Changed = Func;
        Func(Dropdown.Value);
    end;
    local function PopulateDropdown()
        for _, Child in next, ScrollingFrame:GetChildren() do
            if Child:IsA('TextLabel') then
                Child:Destroy();
            end;
        end;
        for _, Value in next, Dropdown.Values do
            local Option = Library:CreateLabel({
                Size = UDim2.new(1, 0, 0, 16);
                TextSize = 14;
                Text = tostring(Value);
                TextXAlignment = Enum.TextXAlignment.Left;
                ZIndex = 12;
                Parent = ScrollingFrame;
            });
            Library:OnHighlight(Option, Option,
                { TextColor3 = 'AccentColor' },
                { TextColor3 = 'FontColor' }
            );
            Option.InputBegan:Connect(function(Input)
                if (Input.UserInputType == Enum.UserInputType.MouseButton1 or (Library.IsMobile and Input.UserInputType == Enum.UserInputType.Touch)) then
                    if Dropdown.Multi then
                        Dropdown.Value[Value] = not Dropdown.Value[Value];
                    else
                        Dropdown.Value = Value;
                        DropdownFrame.Visible = false;
                        Library.OpenedFrames[DropdownFrame] = nil;
                    end;
                    Dropdown:Update();
                    Library:AttemptSave();
                end;
            end);
        end;
        ScrollingFrame.CanvasSize = UDim2.new(0, 0, 0, Layout.AbsoluteContentSize.Y);
    end;
    DropdownInner.InputBegan:Connect(function(Input)
        if (Input.UserInputType == Enum.UserInputType.MouseButton1 or (Library.IsMobile and Input.UserInputType == Enum.UserInputType.Touch)) and not Library:MouseIsOverOpenedFrame() then
            if DropdownFrame.Visible then
                DropdownFrame.Visible = false;
                Library.OpenedFrames[DropdownFrame] = nil;
            else
                for Frame, _ in next, Library.OpenedFrames do
                    Frame.Visible = false;
                    Library.OpenedFrames[Frame] = nil;
                end;
                DropdownFrame.Visible = true;
                DropdownFrame.Size = UDim2.new(1, 0, 0, math.min(Layout.AbsoluteContentSize.Y, 100));
                Library.OpenedFrames[DropdownFrame] = true;
            end;
        end;
    end);
    Library:GiveSignal(InputService.InputBegan:Connect(function(Input)
        if (Input.UserInputType == Enum.UserInputType.MouseButton1 or (Library.IsMobile and Input.UserInputType == Enum.UserInputType.Touch)) then
            local AbsPos, AbsSize = DropdownFrame.AbsolutePosition, DropdownFrame.AbsoluteSize;
            local InputPos = Library.IsMobile and Input.Position or Vector2.new(Mouse.X, Mouse.Y);
            if InputPos.X < AbsPos.X or InputPos.X > AbsPos.X + AbsSize.X
                or InputPos.Y < AbsPos.Y or InputPos.Y > AbsPos.Y + AbsSize.Y then
                DropdownFrame.Visible =Ð»Ð¾Ð³

System: false;
                Library.OpenedFrames[DropdownFrame] = nil;
            end;
        end;
    end));
    PopulateDropdown();
    Dropdown:Update();
    Groupbox:AddBlank(5);
    Groupbox:Resize();
    Options[Idx] = Dropdown;
    return Dropdown;
end;
function Funcs:AddDependencyBox()
    local Depbox = {
        Dependencies = {},
    };
    local Groupbox = self;
    local Container = Groupbox.Container;
    local Frame = Library:Create('Frame', {
        BackgroundTransparency = 1;
        Size = UDim2.new(1, 0, 0, 0);
        Visible = true;
        Parent = Container;
    });
    local Layout = Library:Create('UIListLayout', {
        FillDirection = Enum.FillDirection.Vertical;
        SortOrder = Enum.SortOrder.LayoutOrder;
        Parent = Frame;
    });
    function Depbox:SetupDependencies(Dependencies)
        for _, Dependency in next, Dependencies do
            assert(Dependency.Condition, 'AddDependency: Missing condition');
            table.insert(Depbox.Dependencies, Dependency);
        end;
    end;
    function Depbox:Update()
        local Visible = true;
        for _, Dependency in next, Depbox.Dependencies do
            local Value = Dependency.Value;
            if type(Value) == 'function' then
                Value = Value();
            end;
            local Passed = Dependency.Condition(Value);
            if not Passed then
                Visible = false;
                break;
            end;
        end;
        Frame.Visible = Visible;
        Groupbox:Resize();
    end;
    Library.DependencyBoxes[Frame] = Depbox;
    setmetatable(Depbox, BaseAddons);
    Groupbox:Resize();
    return Depbox;
end;
function Funcs:Resize()
    local Size = 0;
    for _, Child in next, self.Container:GetChildren() do
        if Child:IsA('Frame') and Child.Visible then
            Size = Size + Child.AbsoluteSize.Y;
        elseif Child:IsA('TextLabel') and Child.Visible then
            Size = Size + Child.TextBounds.Y;
        end;
    end;
    self.Container.Size = UDim2.new(1, 0, 0, Size + 5);
end;
setmetatable(BaseGroupbox, { __index = Funcs });
end;
local BaseTab = {};
do
    local Funcs = {};
    function Funcs:AddGroupbox(Title)
        local Groupbox = setmetatable({
            Title = Title or '';
        }, BaseGroupbox);
        local Container = Library:Create('Frame', {
            BackgroundTransparency = 1;
            Size = UDim2.new(1, 0, 0, 0);
            ZIndex = 1;
            Parent = self.Container;
        });
        local TitleLabel = Library:CreateLabel({
            Size = UDim2.new(1, -8, 0, 20);
            TextSize = 16;
            Text = Title;
            TextXAlignment = Enum.TextXAlignment.Left;
            ZIndex = 2;
            Parent = Container;
        });
        local InnerFrame = Library:Create('Frame', {
            BackgroundColor3 = Library.BackgroundColor;
            BorderColor3 = Library.OutlineColor;
            BorderMode = Enum.BorderMode.Inset;
            Position = UDim2.new(0, 4, 0, 20);
            Size = UDim2.new(1, -8, 1, -24);
            ZIndex = 1;
            Parent = Container;
        });
        Library:AddToRegistry(InnerFrame, {
            BackgroundColor3 = 'BackgroundColor';
            BorderColor3 = 'OutlineColor';
        });
        local ContentContainer = Library:Create('Frame', {
            BackgroundTransparency = 1;
            Position = UDim2.new(0, 0, 0, 5);
            Size = UDim2.new(1, 0, 1, -5);
            ZIndex = 1;
            Parent = InnerFrame;
        });
        Groupbox.Container = ContentContainer;
        Groupbox:Resize();
        return Groupbox;
    end;
    function Funcs:Show()
        for _, Tab in next, Library.CurrentTab do
            Tab:Hide();
        end;
        Library.CurrentTab = self;
        self.Container.Visible = true;
    end;
    function Funcs:Hide()
        self.Container.Visible = false;
    end;
    setmetatable(BaseTab, { __index = Funcs });
end;
function Library:CreateWindow(Info)
    assert(Info.Title, 'CreateWindow: Missing title.');
    local Window = {
        Tabs = {},
        Title = Info.Title or 'UI Library';
        Keybinds = {};
        WatermarkText = Info.Watermark or '';
    };
    local MainFrame = Library:Create('Frame', {
        BackgroundColor3 = Library.BackgroundColor;
        BorderColor3 = Library.OutlineColor;
        Position = UDim2.new(0.5, -250, 0.5, -200);
        Size = UDim2.new(0, 500, 0, 400);
        ZIndex = 1;
        Parent = ScreenGui;
    });
    Library:MakeDraggable(MainFrame);
    Library:AddToRegistry(MainFrame, {
        BackgroundColor3 = 'BackgroundColor';
        BorderColor3 = 'OutlineColor';
    });
    local Topbar = Library:Create('Frame', {
        BackgroundColor3 = Library.MainColor;
        BorderColor3 = Library.OutlineColor;
        Size = UDim2.new(1, 0, 0, 30);
        ZIndex = 2;
        Parent = MainFrame;
    });
    Library:AddToRegistry(Topbar, {
        BackgroundColor3 = 'MainColor';
        BorderColor3 = 'OutlineColor';
    });
    local TitleLabel = Library:CreateLabel({
        Position = UDim2.new(0, 10, 0, 0);
        Size = UDim2.new(1, -40, 1, 0);
        TextSize = 16;
        Text = Window.Title;
        ZIndex = 3;
        Parent = Topbar;
    });
    local TabContainer = Library:Create('Frame', {
        BackgroundTransparency = 1;
        Position = UDim2.new(0, 0, 0, 30);
        Size = UDim2.new(1, 0, 0, 30);
        ZIndex = 2;
        Parent = MainFrame;
    });
    local TabListLayout = Library:Create('UIListLayout', {
        FillDirection = Enum.FillDirection.Horizontal;
        SortOrder = Enum.SortOrder.LayoutOrder;
        Padding = UDim.new(0, 4);
        Parent = TabContainer;
    });
    local ContentContainer = Library:Create('Frame', {
        BackgroundTransparency = 1;
        Position = UDim2.new(0, 0, 0, 60);
        Size = UDim2.new(1, 0, 1, -60);
        ZIndex = 1;
        Parent = MainFrame;
    });
    Library.KeybindFrame = Library:Create('Frame', {
        BackgroundColor3 = Library.MainColor;
        BorderColor3 = Library.OutlineColor;
        Size = UDim2.new(0, 210, 0, 20);
        Position = UDim2.new(0, 10, 0, 10);
        ZIndex = 100;
        Visible = false;
        Parent = ScreenGui;
    });
    Library.KeybindContainer = Library:Create('Frame', {
        BackgroundTransparency = 1;
        Size = UDim2.new(1, 0, 1, -23);
        Position = UDim2.new(0, 0, 0, 23);
        ZIndex = 101;
        Parent = Library.KeybindFrame;
    });
    Library:Create('UIListLayout', {
        FillDirection = Enum.FillDirection.Vertical;
        SortOrder = Enum.SortOrder.LayoutOrder;
        Parent = Library.KeybindContainer;
    });
    Library:CreateLabel({
        Size = UDim2.new(1, -4, 0, 20);
        Position = UDim2.new(0, 4, 0, 2);
        Text = 'Keybinds';
        TextSize = 14;
        TextXAlignment = Enum.TextXAlignment.Left;
        ZIndex = 101;
        Parent = Library.KeybindFrame;
    });
    Library:AddToRegistry(Library.KeybindFrame, {
        BackgroundColor3 = 'MainColor';
        BorderColor3 = 'OutlineColor';
    });
    -- Mobile-specific UI buttons
    if Library.IsMobile then
        local MobileButtonContainer = Library:Create('Frame', {
            BackgroundTransparency = 1;
            Size = UDim2.new(0, 120, 0, 80);
            Position = UDim2.new(1, -130, 0, 10);
            ZIndex = 100;
            Parent = ScreenGui;
        });
        local function CreateMobileButton(Text, Callback)
            local ButtonOuter = Library:Create('Frame', {
                BackgroundColor3 = Color3.new(0, 0, 0);
                BorderColor3 = Color3.new(0, 0, 0);
                Size = UDim2.new(1, -4, 0, 30);
                ZIndex = 101;
                Parent = MobileButtonContainer;
            });
            local ButtonInner = Library:Create('Frame', {
                BackgroundColor3 = Library.MainColor;
                BorderColor3 = Library.OutlineColor;
                BorderMode = Enum.BorderMode.Inset;
                Size = UDim2.new(1, 0, 1, 0);
                ZIndex = 102;
                Parent = ButtonOuter;
            });
            Library:Create('UIGradient', {
                Color = ColorSequence.new({
                    ColorSequenceKeypoint.new(0, Color3.new(1, 1, 1)),
                    ColorSequenceKeypoint.new(1, Color3.fromRGB(212, 212, 212))
                });
                Rotation = 90;
                Parent = ButtonInner;
            });
            local ButtonLabel = Library:CreateLabel({
                Size = UDim2.new(1, 0, 1, 0);
                TextSize = 14;
                Text = Text;
                ZIndex = 103;
                Parent = ButtonInner;
            });
            Library:AddToRegistry(ButtonOuter, { BorderColor3 = 'Black' });
            Library:AddToRegistry(ButtonInner, { BackgroundColor3 = 'MainColor', BorderColor3 = 'OutlineColor' });
            Library:OnHighlight(ButtonOuter, ButtonOuter,
                { BorderColor3 = 'AccentColor' },
                { BorderColor3 = 'Black' }
            );
            ButtonOuter.InputBegan:Connect(function(Input)
                if Input.UserInputType == Enum.UserInputType.Touch then
                    Callback();
                end;
            end);
            return ButtonOuter;
        end;
        local LockButton = CreateMobileButton('Lock UI', function()
            Library.UILocked = not Library.UILocked;
            Library:Notify(Library.UILocked and 'UI Locked' or 'UI Unlocked', 2);
        end);
        local ToggleButton = CreateMobileButton('Toggle UI', function()
            Library:Toggle();
        end);
        Library:Create('UIListLayout', {
            FillDirection = Enum.FillDirection.Vertical;
            SortOrder = Enum.SortOrder.LayoutOrder;
            Padding = UDim.new(0, 5);
            Parent = MobileButtonContainer;
        });
    end;
    function Window:AddTab(Title)
        local Tab = setmetatable({
            Title = Title or '';
        }, BaseTab);
        local TabButton = Library:Create('TextButton', {
            BackgroundTransparency = 1;
            Size = UDim2.new(0, Library:GetTextBounds(Title, Library.Font, 16) + 10, 0, 30);
            TextSize = 16;
            Text = Title;
            TextColor3 = Library.FontColor;
            ZIndex = 3;
            Parent = TabContainer;
        });
        Library:AddToRegistry(TabButton, { TextColor3 = 'FontColor' });
        local TabFrame = Library:Create('Frame', {
            BackgroundTransparency = 1;
            Size = UDim2.new(1, 0, 1, 0);
            Visible = false;
            ZIndex = 1;
            Parent = ContentContainer;
        });
        Tab.Container = TabFrame;
        Library:OnHighlight(TabButton, TabButton,
            { TextColor3 = 'AccentColor' },
            { TextColor3 = 'FontColor' }
        );
        TabButton.Activated:Connect(function()
            Tab:Show();
        end);
        if #Window.Tabs == 0 then
            Tab:Show();
        end;
        table.insert(Window.Tabs, Tab);
        return Tab;
    end;
    function Window:SetTitle(Title)
        Window.Title = Title;
        TitleLabel.Text = Title;
    end;
    function Window:SetWatermark(Watermark)
        Window.WatermarkText = Watermark;
        if Window.WatermarkLabel then
            Window.WatermarkLabel.Text = Watermark;
        end;
    end;
    function Window:Toggle()
        MainFrame.Visible = not MainFrame.Visible;
    end;
    if Window.WatermarkText and Window.WatermarkText ~= '' then
        Window.WatermarkLabel = Library:CreateLabel({
            Position = UDim2.new(0, 10, 1, -30);
            Size = UDim2.new(0, Library:GetTextBounds(Window.WatermarkText, Library.Font, 14) + 10, 0, 20);
            TextSize = 14;
            Text = Window.WatermarkText;
            TextXAlignment = Enum.TextXAlignment.Left;
            ZIndex = 100;
            Parent = ScreenGui;
        });
    end;
    return Window;
end;
function Library:Notify(Text, Duration)
    local Notification = Library:Create('Frame', {
        BackgroundColor3 = Library.MainColor;
        BorderColor3 = Library.OutlineColor;
        Size = UDim2.new(0, 200, 0, 50);
        Position = UDim2.new(0, 10, 0, 10);
        ZIndex = 100;
        Parent = ScreenGui;
    });
    Library:AddToRegistry(Notification, {
        BackgroundColor3 = 'MainColor';
        BorderColor3 = 'OutlineColor';
    });
    local NotificationLabel = Library:CreateLabel({
        Size = UDim2.new(1, -10, 1, -10);
        Position = UDim2.new(0, 5, 0, 5);
        TextSize = 14;
        Text = Text;
        TextWrapped = true;
        ZIndex = 101;
        Parent = Notification;
    });
    task.spawn(function()
        wait(Duration or 3);
        Notification:Destroy();
    end);
end;
function Library:SetSaveManager(SaveManager)
    Library.SaveManager = SaveManager;
end;
return Library;
